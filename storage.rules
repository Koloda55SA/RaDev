rules_version = '2';
service firebase.storage {
  match /b/{bucket}/o {
    // Аватары пользователей - только владелец может загружать/удалять, все могут читать
    match /avatars/{userId}/{allPaths=**} {
      allow read: if true;
      allow write: if request.auth != null && request.auth.uid == userId &&
                   request.resource.size < 5 * 1024 * 1024 && // Максимум 5MB
                   request.resource.contentType.matches('image/.*');
      allow delete: if request.auth != null && request.auth.uid == userId;
    }
    
    // Изображения в чате - только участники чата могут загружать/читать
    match /chat_images/{userId}/{allPaths=**} {
      allow read: if request.auth != null;
      allow write: if request.auth != null && request.auth.uid == userId &&
                   request.resource.size < 10 * 1024 * 1024 && // Максимум 10MB
                   request.resource.contentType.matches('image/.*');
      allow delete: if request.auth != null && request.auth.uid == userId;
    }
    
    // Проекты - все могут читать, только админы могут загружать
    match /projects/{allPaths=**} {
      allow read: if true;
      allow write: if request.auth != null && 
                   exists(/databases/$(database)/documents/users/$(request.auth.uid)) &&
                   get(/databases/$(database)/documents/users/$(request.auth.uid)).data.role == 'admin';
    }
  }
}

