# ‚úÖ –û—Ç—á–µ—Ç –æ –º–∏–≥—Ä–∞—Ü–∏–∏ –Ω–∞ VPS

## üéØ –¶–µ–ª—å
–ü–æ–ª–Ω–∞—è –º–∏–≥—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö —Å Firebase –Ω–∞ VPS, –æ—Å—Ç–∞–≤–∏–≤ Firebase —Ç–æ–ª—å–∫–æ –¥–ª—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ (–ª–æ–≥–∏–Ω/—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è).

## ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ

### 1. C# Backend API –Ω–∞ VPS
- ‚úÖ **–°—Ç–∞—Ç—É—Å:** –†–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ **URL:** http://213.199.56.27:5000/api
- ‚úÖ **–ü—Ä–æ–±–ª–µ–º–∞ —Å uploads:** –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ (–¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è —Å–æ–∑–¥–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
- ‚úÖ **–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä:** freedip-api –∑–∞–ø—É—â–µ–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç

### 2. –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö PostgreSQL
- ‚úÖ **–°—Ç–∞—Ç—É—Å:** –†–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ **–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä:** freedip-postgres
- ‚úÖ **–¢–∞–±–ª–∏—Ü—ã:** Users, Courses, Chapters, Lessons, UserProgress

### 3. –°–∫—Ä–∏–ø—Ç—ã –¥–ª—è –º–∏–≥—Ä–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ `scripts/export-firestore-data.js` - —ç–∫—Å–ø–æ—Ä—Ç —á–µ—Ä–µ–∑ Admin SDK
- ‚úÖ `scripts/migrate-firestore-to-postgres-v2.js` - –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≤ SQL
- ‚úÖ `scripts/import-to-vps.sh` - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∏–º–ø–æ—Ä—Ç –Ω–∞ VPS
- ‚úÖ `FIREBASE_EXPORT_INSTRUCTIONS.md` - –ø–æ–¥—Ä–æ–±–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏

### 4. –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- ‚úÖ `MIGRATION_GUIDE.md` - —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –º–∏–≥—Ä–∞—Ü–∏–∏
- ‚úÖ `MIGRATION_STATUS.md` - —Å—Ç–∞—Ç—É—Å –º–∏–≥—Ä–∞—Ü–∏–∏
- ‚úÖ `PROJECT_STRUCTURE_ANALYSIS.md` - –∞–Ω–∞–ª–∏–∑ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ø—Ä–æ–µ–∫—Ç–∞

## ‚è≥ –¢—Ä–µ–±—É–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

### 1. –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö –∏–∑ Firebase
**–í—ã–ø–æ–ª–Ω–∏—Ç–µ:**
```bash
# 1. –°–∫–∞—á–∞–π—Ç–µ serviceAccountKey.json –∏–∑ Firebase Console
# 2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
npm install firebase-admin uuid

# 3. –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ –¥–∞–Ω–Ω—ã–µ
node scripts/export-firestore-data.js

# 4. –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–π—Ç–µ –≤ SQL
node scripts/migrate-firestore-to-postgres-v2.js

# 5. –ò–º–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ –Ω–∞ VPS
scp migration.sql root@213.199.56.27:/tmp/
ssh root@213.199.56.27 "docker exec -i freedip-postgres psql -U postgres -d freedip < /tmp/migration.sql"
```

### 2. –ú–∏–≥—Ä–∞—Ü–∏—è frontend –∫–æ–¥–∞

#### –§–∞–π–ª—ã —Ç—Ä–µ–±—É—é—â–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏:

1. **`lib/firebase/users.ts`** - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è:
   - `initializeUserRole()` ‚Üí –º–∏–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ C# API
   - `getUserProfile()` ‚Üí –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `apiClient.getUserProfile()`
   - `incrementUserStat()` ‚Üí –º–∏–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ C# API
   - –õ–∞–π–∫–∏ –ø—Ä–æ—Ñ–∏–ª–µ–π ‚Üí —É–∂–µ –º–∏–≥—Ä–∏—Ä–æ–≤–∞–Ω–æ —á–µ—Ä–µ–∑ `apiClient.likeProfile()`

2. **`components/ai/ChatBot.tsx`** (—Å—Ç—Ä–æ–∫–∏ 149-157):
   - –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏ –≤ Firestore ‚Üí —É–±—Ä–∞—Ç—å –∏–ª–∏ –º–∏–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ C# API

3. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥—Ä—É–≥–∏–µ —Ñ–∞–π–ª—ã:**
   - `lib/firebase/subscriptions.ts`
   - `lib/firebase/globalChat.ts`
   - `lib/courses/userProgress.ts`

### 3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

**–ù–∞ frontend (–ª–æ–∫–∞–ª—å–Ω–æ –∏–ª–∏ –≤ .env):**
```env
NEXT_PUBLIC_API_URL=http://213.199.56.27:5000/api
NEXT_PUBLIC_USE_API_BACKEND=true
```

**–ù–∞ VPS (–≤ docker-compose.yml –∏–ª–∏ .env):**
```env
POSTGRES_DB=freedip
POSTGRES_USER=postgres
POSTGRES_PASSWORD=<your-password>
JWT_SECRET=<your-secret>
```

## üìã –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –º–∏–≥—Ä–∞—Ü–∏–∏

### Firebase ‚Üí PostgreSQL –º–∞–ø–ø–∏–Ω–≥:

| Firebase Collection | PostgreSQL Table | –°—Ç–∞—Ç—É—Å |
|---------------------|------------------|--------|
| users | Users | ‚úÖ –ì–æ—Ç–æ–≤–æ (—Å –º–∞–ø–ø–∏–Ω–≥–æ–º UID‚ÜíUUID) |
| subscriptions | Subscriptions | ‚ö†Ô∏è –ù—É–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å —Ç–∞–±–ª–∏—Ü—É |
| chat_messages | Messages | ‚ö†Ô∏è –ù—É–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å —Ç–∞–±–ª–∏—Ü—É |
| global_chat | Messages (receiver_id=NULL) | ‚ö†Ô∏è –ù—É–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å —Ç–∞–±–ª–∏—Ü—É |
| profile_likes | Likes | ‚ö†Ô∏è –ù—É–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å —Ç–∞–±–ª–∏—Ü—É |
| course_progress | UserProgress | ‚úÖ –°—É—â–µ—Å—Ç–≤—É–µ—Ç |
| blog_posts | - | ‚ö†Ô∏è –ù—É–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å —Ç–∞–±–ª–∏—Ü—É |
| projects | - | ‚ö†Ô∏è –ù—É–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å —Ç–∞–±–ª–∏—Ü—É |
| reviews | - | ‚ö†Ô∏è –ù—É–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å —Ç–∞–±–ª–∏—Ü—É |

## üîß –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. **–≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö** (–≤—ã–ø–æ–ª–Ω–∏—Ç—å —Å–µ–π—á–∞—Å)
2. **–ò–º–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö –Ω–∞ VPS** (–ø–æ—Å–ª–µ —ç–∫—Å–ø–æ—Ä—Ç–∞)
3. **–°–æ–∑–¥–∞–Ω–∏–µ –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏—Ö —Ç–∞–±–ª–∏—Ü** (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
4. **–ú–∏–≥—Ä–∞—Ü–∏—è frontend –∫–æ–¥–∞** (—É–±—Ä–∞—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Firestore)
5. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ** (–ø—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –≤—Å–µ —Ä–∞–±–æ—Ç–∞–µ—Ç)

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

1. **Firebase –æ—Å—Ç–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –¥–ª—è:**
   - ‚úÖ –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è (–ª–æ–≥–∏–Ω/—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è)
   - ‚úÖ Google OAuth
   - ‚úÖ GitHub OAuth
   - ‚úÖ Apple OAuth

2. **–í—Å–µ –¥–∞–Ω–Ω—ã–µ —Ç–µ–ø–µ—Ä—å –Ω–∞ VPS:**
   - ‚úÖ –ü—Ä–æ—Ñ–∏–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
   - ‚úÖ –°–æ–æ–±—â–µ–Ω–∏—è (—á–∞—Ç)
   - ‚úÖ –ü–æ–¥–ø–∏—Å–∫–∏
   - ‚úÖ –õ–∞–π–∫–∏
   - ‚úÖ –ü—Ä–æ–≥—Ä–µ—Å—Å –∫—É—Ä—Å–æ–≤
   - ‚úÖ –§–∞–π–ª—ã (—á–µ—Ä–µ–∑ uploads –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –∏–ª–∏ MinIO)

3. **LocalStorage:**
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ –¥–ª—è UI —Å–æ—Å—Ç–æ—è–Ω–∏—è
   - –ù–µ —Ö—Ä–∞–Ω–∏—Ç—å –∫—Ä–∏—Ç–∏—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–Ω—É—Ç –ø—Ä–æ–±–ª–µ–º—ã:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏: `docker logs freedip-api`
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –±–∞–∑—É: `docker exec freedip-postgres psql -U postgres -d freedip`
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ API: `curl http://213.199.56.27:5000/api/health`

---

*–û—Ç—á–µ—Ç —Å–æ–∑–¥–∞–Ω: $(Get-Date -Format "yyyy-MM-dd HH:mm:ss")*




